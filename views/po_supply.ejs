<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PO Query Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <header>
        <nav class="navbar bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">
                    <img src="/docs/5.2/assets/brand/bootstrap-logo.svg" alt="" width="30" height="24"
                        class="d-inline-block align-text-top">
                    Levior Energy
                </a>
            </div>
        </nav>
    </header>
    <main style="margin-left: 15px;margin-right: 15px;">
        <p class="h3">Purchase Order Supply</p>
        <div class="row align-items-start">
            <div class="col-sm-9">
                <div class="row align-items-start">
                    <div class="col-sm-9">
                        <!--FORM PO GENERATOR TODELIVER-->
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1" style="width: 135px;">Project Name</span>
                            <input type="text" class="form-control" placeholder="Project Name" aria-label="placeholder"
                                aria-describedby="basic-addon1" id="input-name">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1" style="width: 135px;">Ship TO</span>
                            <input type="text" class="form-control" placeholder="Ship To" aria-label="placeholder"
                                aria-describedby="basic-addon1" id="input-ship">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1" style="width: 135px;">Requisitioner</span>
                            <input type="text" class="form-control" placeholder="Requisitioner" aria-label="placeholder"
                                aria-describedby="basic-addon1" id="input-req">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1" style="width: 135px;">SHIP VIA</span>
                            <input type="text" class="form-control" placeholder="Ship VIA" aria-label="placeholder"
                                aria-describedby="basic-addon1" id="input-via">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1" style="width: 135px;">F.O.B.</span>
                            <input type="text" class="form-control" placeholder="F.O.B." aria-label="placeholder"
                                aria-describedby="basic-addon1" id="input-fob">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text" id="basic-addon1" style="width: 135px;">Shipping Terms</span>
                            <input type="text" class="form-control" placeholder="Shipping Terms"
                                aria-label="placeholder" aria-describedby="basic-addon1" id="input-terms">
                        </div>
                        <!--ITEM TABLE-->
                        <label for="basic-url" class="form-label h3">Items</label>
                        <table class="table table-striped" id="tablePO">
                            <thead>
                                <tr>
                                    <th scope="col">Model</th>
                                    <th scope="col">Alternative Model</th>
                                    <th scope="col">Description</th>
                                    <th scope="col">Quantity</th>
                                </tr>
                            </thead>
                            <tbody class="editable-body" id="body-to-populate">
                            </tbody>
                        </table>
                    </div>
                    <!--MIDDLE COLUMN-->
                    <div class="col-3">
                        <p class="h6">Load PO</p>
                        <div class="input-group mb-3">
                            <label class="input-group-text" for="inputGroupSelect01">PO No.</label>
                            <select class="form-select" id="inputGroupSelect01" onchange="selectPO()">
                                <option selected value="0">Choose...</option>
                                <% for(var i=0; i<poList.length; i++) { %>
                                    <option value="<%= poList[i] %> ">
                                        <%= poList[i] %>
                                    </option>
                                    <% } %>
                            </select>
                        </div>
                        <p class="h6">PO Data</p>
                        <table class="table table-striped">
                            <tbody>
                                <tr>
                                    <th scope="row">Input Date</th>
                                    <td>03/09/2022</td>
                                </tr>
                                <tr>
                                    <th scope="row">Purchase Order No.</th>
                                    <td>ELP-2022-1</td>
                                </tr>
                        </table>
                    </div>
                </div>
            </div>
            <!--RIGHT BUTTON SET-->
            <div class="col-3">
                <p class="h4">Actions</p>
                <div class="d-grid gap-2">
                    <button class="btn btn-success" type="button" onclick="pushSupply()">Supply PO</button>
                    <button class="btn btn-secondary" type="button" onclick="window.print()">Print PDF</button>
                    <button class="btn btn-danger" type="button" onclick="clearAll()">Clear Form</button>
                    <a class="btn btn-primary" type="button" href="/">Return to Menu</a>
                </div>
            </div>
        </div>
    </main>
</body>
<script>
    //SELECT PO FUNCTION FETCH DATA
    function selectPO() {
        var select = document.getElementById('inputGroupSelect01');
        var value = select.options[select.selectedIndex].value;
        if (value != 0) {
            clearAll();
            fetch('/PO_Query/populate', {
                headers: {
                    'Content-Type': 'application/json'
                },
                method: 'POST',
                body: JSON.stringify({
                    dataSearch: value
                })
            })
                .then(response => response.json())
                .then(data => {
                    data.forEach(row => {
                        document.getElementById("input-name").value = row.projectName;
                        document.getElementById("input-ship").value = row.shipTo;
                        document.getElementById("input-req").value = row.requisitioner;

                        var itemList = document.getElementById("body-to-populate");
                        var newRow = document.createElement("tr");

                        var modelCell = document.createElement("td");
                        modelCell.classList.add("model");
                        modelCell.innerHTML = row.model;

                        var altCell = document.createElement("td");
                        altCell.classList.add("alt");

                        var descCell = document.createElement("td");
                        descCell.classList.add("desc");
                        descCell.innerHTML = row.description;

                        var qntyCell = document.createElement("td");
                        qntyCell.classList.add("qnty");
                        qntyCell.innerHTML = row.quantity;

                        newRow.appendChild(modelCell);
                        newRow.appendChild(altCell);
                        newRow.appendChild(descCell);
                        newRow.appendChild(qntyCell);

                        itemList.appendChild(newRow);
                    });
                    setEditable();
                });

        }
    }

    function setEditable() {
        var tbody = document.getElementsByClassName('editable-body');

        for (var i = 0; i < tbody.length; i++) {
            var tds = tbody[i].getElementsByTagName("td");
            for (var n = 0; n < tds.length; n++) {
                tds[n].setAttribute('contenteditable', 'true');
            }
        }
    }
</script>
<script>
    //JQUERY FUNCTIONS
    function clearTable() {
        $("#body-to-populate").html("");
    }

    function clearAll() {
        $("#input-name").val("");
        $("#input-ship").val("");
        $("#input-req").val("");
        $("#input-via").val("");
        $("#input-fob").val("");
        $("#input-terms").val("");
        clearTable();
    }

    function pushSupply() {
        $('#tablePO > tbody > tr').each(function () {
            var pName = $("#input-name").val();
            var shipTo = $("#input-ship").val();
            var requis = $("#input-req").val();
            var via = $("#input-via").val();
            var fob = $("#input-fob").val();
            var terms = $("#input-terms").val();

            var model = $(this).find(".model").text();
            var alt = $(this).find(".alt").text();
            var desc = $(this).find(".desc").text();
            var qnty = $(this).find(".qnty").text();

            var poID = $("#inputGroupSelect01 option:selected").val();

            $.post("PO_Query/save", {
                pName: pName,
                shipTo: shipTo,
                requis: requis,
                via: via,
                fob: fob,
                terms: terms,
                model: model,
                alt: alt,
                desc: desc,
                qnty: qnty,
                poID: poID
            },
                function (data, status) { });
            $(this).remove();
        });
        clearAll();
    }
</script>

</html>